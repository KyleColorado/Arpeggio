<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arpeggio Generator</title>
    <style>
        body {
            background-color: #282c34;
            color: white;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        select, button, input {
            margin: 10px;
            padding: 10px;
            background-color: #333;
            border: none;
            color: white;
        }
        input[type="range"] {
            width: 300px;
        }
    </style>
</head>
<body>
    <h1>Arpeggio Generator</h1>
    <select id="scaleType">
        <option value="major">Major</option>
        <option value="minor">Minor</option>
        <option value="dorian">Dorian</option>
        <option value="phrygian">Phrygian</option>
        <option value="lydian">Lydian</option>
        <option value="mixolydian">Mixolydian</option>
        <option value="aeolian">Aeolian</option>
        <option value="locrian">Locrian</option>
        <option value="harmonicMinor">Harmonic Minor</option>
        <option value="melodicMinor">Melodic Minor</option>
    </select>
    <select id="patternType">
        <option value="up">Up</option>
        <option value="down">Down</option>
        <option value="upAndDown">Up and Down</option>
        <option value="random">Random</option>
    </select>
    <input id="tempo" type="range" min="60" max="180" value="120">
    <button onclick="playArpeggio()">Play</button>
    <button onclick="stopArpeggio()">Stop</button>
    <script>
        let audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let tempo = document.getElementById('tempo').value;
        let intervalId = null;

        function playArpeggio() {
            if (intervalId) clearInterval(intervalId);

            const scaleType = document.getElementById('scaleType').value;
            const patternType = document.getElementById('patternType').value;
            const frequencies = calculateFrequencies(scaleType);
            const order = getOrder(patternType, frequencies.length);
            let index = 0;

            intervalId = setInterval(() => {
                if (index >= order.length) index = 0;
                createOscillator(frequencies[order[index]], 'sine');
                index++;
            }, 60000 / document.getElementById('tempo').value);
        }

        function stopArpeggio() {
            clearInterval(intervalId);
            intervalId = null;
        }

        document.getElementById('tempo').addEventListener('input', function() {
            if (intervalId) playArpeggio(); // Re-start the arpeggio with new tempo
        });

        function getOrder(patternType, length) {
            switch (patternType) {
                case 'up':
                    return Array.from(Array(length).keys());
                case 'down':
                    return Array.from(Array(length).keys()).reverse();
                case 'upAndDown':
                    const up = Array.from(Array(length).keys());
                    const down = up.slice().reverse().slice(1, -1);
                    return up.concat(down);
                case 'random':
                    return Array.from(Array(length).keys()).sort(() => Math.random() - 0.5);
                default:
                    return [];
            }
        }

        function calculateFrequencies(scaleType) {
            const baseFrequency = 261.63; // Middle C (C4)
            switch (scaleType) {
                // Add each scale's frequency pattern based on the selected type
                case 'major':
                    return [baseFrequency, baseFrequency * Math.pow(2, 2/12), baseFrequency * Math.pow(2, 4/12), baseFrequency * Math.pow(2, 5/12), baseFrequency * Math.pow(2, 7/12), baseFrequency * Math.pow(2, 9/12), baseFrequency * Math.pow(2, 11/12), baseFrequency * 2];
                case 'minor':
                    return [baseFrequency, baseFrequency * Math.pow(2, 2/12), baseFrequency * Math.pow(2, 3/12), baseFrequency * Math.pow(2, 5/12), baseFrequency * Math.pow(2, 7/12), baseFrequency * Math.pow(2, 8/12), baseFrequency * Math.pow(2, 10/12), baseFrequency * 2];
                // Additional scales are defined here with their specific interval patterns
                case 'dorian':
                    // Define other scales similarly...
                default:
                    return [baseFrequency];
            }
        }

        function createOscillator(freq, type) {
            const oscillator = audioContext.createOscillator();
            oscillator.type = type;
            oscillator.frequency.value = freq;
            const envelope = audioContext.createGain();
            envelope.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 1);
            oscillator.connect(envelope);
            envelope.connect(audioContext.destination);
            oscillator.start();
            setTimeout(() => {
                oscillator.stop();
                oscillator.disconnect();
            }, 500); // Set to 500ms or adjust for note length
        }
    </script>
</body>
</html>
