<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Arpeggio Generator</title>
<style>
    body {
        font-family: 'Arial', sans-serif;
        background-color: #282c34;
        color: #abb2bf;
        padding: 20px;
    }
    select, button, input {
        padding: 10px;
        margin: 5px;
        background: #3a3f4b;
        color: #61afef;
        border: 1px solid #61afef;
        border-radius: 5px;
    }
    label {
        color: #98c379;
    }
    #tempoDisplay {
        color: #e06c75;
    }
</style>
</head>
<body>
    <h1>Arpeggio Generator</h1>
    <div>
        <label for="scaleType">Scale:</label>
        <select id="scaleType">
            <option value="major">Major</option>
            <option value="minor">Minor</option>
            <option value="dorian">Dorian</option>
            <option value="phrygian">Phrygian</option>
            <option value="lydian">Lydian</option>
            <option value="mixolydian">Mixolydian</option>
            <option value="aeolian">Aeolian</option>
            <option value="locrian">Locrian</option>
            <option value="harmonicMinor">Harmonic Minor</option>
            <option value="melodicMinor">Melodic Minor</option>
        </select>
    </div>
    <div>
        <label for="patternType">Pattern:</label>
        <select id="patternType">
            <option value="up">Up</option>
            <option value="down">Down</option>
            <option value="upAndDown">Up and Down</option>
            <option value="random">Random</option>
        </select>
    </div>
    <div>
        <label for="oscillatorType">Waveform Type:</label>
        <select id="oscillatorType">
            <option value="sine">Sine</option>
            <option value="square">Square</option>
            <option value="sawtooth">Sawtooth</option>
            <option value="triangle">Triangle</option>
        </select>
    </div>
    <div>
        <label for="tempoSlider">Tempo (BPM):</label>
        <input type="range" id="tempoSlider" min="60" max="180" value="120">
        <span id="tempoDisplay">120 BPM</span>
    </div>
    <button id="playButton">Play</button>
    <button id="stopButton">Stop</button>

    <script>
        const audioContext = new AudioContext();
        let isPlaying = false, currentInterval;

        document.getElementById('playButton').addEventListener('click', function() {
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            if (!isPlaying) {
                isPlaying = true;
                playArpeggio();
            }
        });

        document.getElementById('stopButton').addEventListener('click', function() {
            isPlaying = false;
            clearInterval(currentInterval);
        });

        document.getElementById('tempoSlider').addEventListener('input', function() {
            document.getElementById('tempoDisplay').textContent = this.value + ' BPM';
            if (isPlaying) {
                clearInterval(currentInterval);
                playArpeggio();
            }
        });

        function playArpeggio() {
            const scaleType = document.getElementById('scaleType').value;
            const patternType = document.getElementById('patternType').value;
            const waveformType = document.getElementById('oscillatorType').value;
            const bpm = parseInt(document.getElementById('tempoSlider').value);
            const noteDuration = (60 / bpm) * 1000; // Duration of each note in milliseconds

            const frequencies = calculateFrequencies(scaleType);
            const noteOrder = getOrder(patternType, frequencies.length);

            let noteIndex = 0;
            currentInterval = setInterval(() => {
                if (!isPlaying) {
                    clearInterval(currentInterval);
                    return;
                }
                const realNoteIndex = noteOrder[noteIndex % noteOrder.length];
                const frequency = frequencies[realNoteIndex];
                const oscillator = createOscillator(frequency, waveformType);
                oscillator.start();
                setTimeout(() => oscillator.stop(), noteDuration);

                noteIndex++;
            }, noteDuration);
        }

        function getOrder(patternType, length) {
            switch (patternType) {
                case 'up':
                    return Array.from(Array(length).keys()); // 0, 1, 2, ..., length-1
                case 'down':
                    return Array.from(Array(length).keys()).reverse(); // length-1, length-2, ..., 0
                case 'upAndDown':
                    const up = Array.from(Array(length).keys());
                    const down = up.slice().reverse().slice(1, -1);
                    return up.concat(down);
                case 'random':
                    return Array.from(Array(length).keys()).sort(() => Math.random() - 0.5);
                default:
                    return [];
            }
        }

        function calculateFrequencies(scaleType) {
            const baseFrequency = 261.63; // Middle C (C4)
            switch (scaleType) {
                case 'major':
                    return [baseFrequency, baseFrequency * Math.pow(2, 2/12), baseFrequency * Math.pow(2, 4/12), baseFrequency * Math.pow(2, 5/12), baseFrequency * Math.pow(2, 7/12), baseFrequency * Math.pow(2, 9/12), baseFrequency * Math.pow(2, 11/12), baseFrequency * 2];
                case 'minor':
                    return [baseFrequency, baseFrequency * Math.pow(2, 2/12), baseFrequency * Math.pow(2, 3/12), baseFrequency * Math.pow(2, 5/12), baseFrequency * Math.pow(2, 7/12), baseFrequency * Math.pow(2, 8/12), baseFrequency * Math.pow(2, 10/12), baseFrequency * 2];
                case 'dorian':
                    return [baseFrequency, baseFrequency * Math.pow(2, 2/12), baseFrequency * Math.pow(2, 3/12), baseFrequency * Math.pow(2, 5/12), baseFrequency * Math.pow(2, 7/12), baseFrequency * Math.pow(2, 9/12), baseFrequency * Math.pow(2, 10/12), baseFrequency * 2];
                case 'phrygian':
                    return [baseFrequency, baseFrequency * Math.pow(2, 1/12), baseFrequency * Math.pow(2, 3/12), baseFrequency * Math.pow(2, 5/12), baseFrequency * Math.pow(2, 7/12), baseFrequency * Math.pow(2, 8/12), baseFrequency * Math.pow(2, 10/12), baseFrequency * 2];
                case 'lydian':
                    return [baseFrequency, baseFrequency * Math.pow(2, 2/12), baseFrequency * Math.pow(2, 4/12), baseFrequency * Math.pow(2, 6/12), baseFrequency * Math.pow(2, 7/12), baseFrequency * Math.pow(2, 9/12), baseFrequency * Math.pow(2, 11/12), baseFrequency * 2];
                case 'mixolydian':
                    return [baseFrequency, baseFrequency * Math.pow(2, 2/12), baseFrequency * Math.pow(2, 4/12), baseFrequency * Math.pow(2, 5/12), baseFrequency * Math.pow(2, 7/12), baseFrequency * Math.pow(2, 9/12), baseFrequency * Math.pow(2, 10/12), baseFrequency * 2];
                case 'aeolian':
                    return [baseFrequency, baseFrequency * Math.pow(2, 2/12), baseFrequency * Math.pow(2, 3/12), baseFrequency * Math.pow(2, 5/12), baseFrequency * Math.pow(2, 7/12), baseFrequency * Math.pow(2, 8/12), baseFrequency * Math.pow(2, 10/12), baseFrequency * 2];
                case 'locrian':
                    return [baseFrequency, baseFrequency * Math.pow(2, 1/12), baseFrequency * Math.pow(2, 3/12), baseFrequency * Math.pow(2, 5/12), baseFrequency * Math.pow(2, 6/12), baseFrequency * Math.pow(2, 8/12), baseFrequency * Math.pow(2, 10/12), baseFrequency * 2];
                case 'harmonicMinor':
                    return [baseFrequency, baseFrequency * Math.pow(2, 2/12), baseFrequency * Math.pow(2, 3/12), baseFrequency * Math.pow(2, 5/12), baseFrequency * Math.pow(2, 7/12), baseFrequency * Math.pow(2, 8/12), baseFrequency * Math.pow(2, 11/12), baseFrequency * 2];
                case 'melodicMinor':
                    return [baseFrequency, baseFrequency * Math.pow(2, 2/12), baseFrequency * Math.pow(2, 3/12), baseFrequency * Math.pow(2, 5/12), baseFrequency * Math.pow(2, 7/12), baseFrequency * Math.pow(2, 9/12), baseFrequency * Math.pow(2, 11/12), baseFrequency * 2];
                default:
                    return [baseFrequency];
            }
        }

        function createOscillator(freq, type) {
            const oscillator = audioContext.createOscillator();
            oscillator.type = type;
            oscillator.frequency.value = freq;
            const envelope = audioContext.createGain();
            envelope.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 1);
            oscillator.connect(envelope);
            envelope.connect(audioContext.destination);
            oscillator.start();
            setTimeout(() => {
                oscillator.stop();
                oscillator.disconnect();
            }, 500);
            return oscillator;
        }
    </script>
</body>
</html>
