<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Arpeggio Generator</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #333;
        color: #fff;
        padding: 20px;
    }
    select, button, input {
        padding: 10px;
        margin: 5px;
        background: #555;
        color: #fff;
        border: none;
        border-radius: 5px;
    }
</style>
</head>
<body>
    <h1>Arpeggio Generator</h1>
    <div>
        <label for="scaleType">Scale:</label>
        <select id="scaleType">
            <option value="major">Major</option>
            <option value="minor">Minor</option>
            <!-- Add more scales as needed -->
        </select>
    </div>
    <div>
        <label for="patternType">Pattern:</label>
        <select id="patternType">
            <option value="up">Up</option>
            <option value="down">Down</option>
            <option value="upAndDown">Up and Down</option>
            <option value="random">Random</option>
        </select>
    </div>
    <div>
        <label for="oscillatorType">Waveform Type:</label>
        <select id="oscillatorType">
            <option value="sine">Sine</option>
            <option value="square">Square</option>
            <option value="sawtooth">Sawtooth</option>
            <option value="triangle">Triangle</option>
        </select>
    </div>
    <div>
        <label for="tempoSlider">Tempo (BPM):</label>
        <input type="range" id="tempoSlider" min="60" max="180" value="120">
        <span id="tempoDisplay">120 BPM</span>
    </div>
    <button id="playButton">Play</button>
    <button id="stopButton">Stop</button>

    <script>
        const audioContext = new AudioContext();
        let isPlaying = false;

        document.getElementById('playButton').addEventListener('click', function() {
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            if (!isPlaying) {
                isPlaying = true;
                playArpeggio();
            }
        });

        document.getElementById('stopButton').addEventListener('click', function() {
            isPlaying = false;
        });

        document.getElementById('tempoSlider').oninput = function() {
            document.getElementById('tempoDisplay').textContent = this.value + ' BPM';
        };

        function playArpeggio() {
            const scaleType = document.getElementById('scaleType').value;
            const patternType = document.getElementById('patternType').value;
            const waveformType = document.getElementById('oscillatorType').value;
            const bpm = parseInt(document.getElementById('tempoSlider').value);
            const noteDuration = (60 / bpm) * 1000; // Duration of each note in milliseconds

            const frequencies = calculateFrequencies(scaleType);
            const noteOrder = getOrder(patternType, frequencies.length);

            let noteIndex = 0;

            function scheduleNextNote() {
                if (!isPlaying) return;
                const realNoteIndex = noteOrder[noteIndex % noteOrder.length];
                const frequency = frequencies[realNoteIndex];
                const oscillator = createOscillator(frequency, waveformType);
                oscillator.start();
                setTimeout(() => {
                    oscillator.stop();
                    if (isPlaying) {
                        scheduleNextNote();
                    }
                }, noteDuration);

                noteIndex++;
            }

            scheduleNextNote();
        }

        function getOrder(pattern, length) {
            switch (pattern) {
                case 'up':
                    return [...Array(length).keys()];
                case 'down':
                    return [...Array(length).keys()].reverse();
                case 'upAndDown':
                    const up = [...Array(length).keys()];
                    const down = [...Array(length).keys()].reverse().slice(1);
                    return up.concat(down);
                case 'random':
                    return [...Array(length).keys()].sort(() => Math.random() - 0.5);
                default:
                    return [...Array(length).keys()];
            }
        }

        function calculateFrequencies(scale) {
            const baseFrequency = 261.63; // C4, Middle C
            switch (scale) {
                case 'major':
                    return [baseFrequency, baseFrequency * Math.pow(2, 2/12), baseFrequency * Math.pow(2, 4/12), baseFrequency * Math.pow(2, 5/12), baseFrequency * Math.pow(2, 7/12), baseFrequency * Math.pow(2, 9/12), baseFrequency * Math.pow(2, 11/12), baseFrequency * 2];
                case 'minor':
                    return [baseFrequency, baseFrequency * Math.pow(2, 2/12), baseFrequency * Math.pow(2, 3/12), baseFrequency * Math.pow(2, 5/12), baseFrequency * Math.pow(2, 7/12), baseFrequency * Math.pow(2, 8/12), baseFrequency * Math.pow(2, 10/12), baseFrequency * 2];
                // Add more scales as needed
                default:
                    return [baseFrequency, baseFrequency * Math.pow(2, 2/12), baseFrequency * Math.pow(2, 4/12), baseFrequency * Math.pow(2, 5/12), baseFrequency * Math.pow(2, 7/12), baseFrequency * Math.pow(2, 9/12), baseFrequency * Math.pow(2, 11/12), baseFrequency * 2];
            }
        }

        function createOscillator(freq, type) {
            const oscillator = audioContext.createOscillator();
            oscillator
